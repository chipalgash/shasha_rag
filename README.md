RAG Prototype (word-aware) for RU DOCX Normatives
–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –Ω–æ —Ç–æ—á–Ω—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø RAG –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–æ—Å—Å–∏–π—Å–∫–∏–º–∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .docx.
–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
–Ø–∑—ã–∫–æ–≤–æ-–æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π —á–∞–Ω–∫–∏–Ω–≥: –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è/–∫–ª–∞—É–∑—ã –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–∞ —Å–ª–æ–≤ + –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü.
–ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ—Ç—Ä–∏–≤–µ—Ä: BM25 (–ª–µ–∫—Å–∏–∫–∞) + FAISS (–ø–ª–æ—Ç–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ multilingual-e5-base) c RRF-—Å–ª–∏—è–Ω–∏–µ–º.
–ö—Ä–æ—Å—Å-—ç–Ω–∫–æ–¥–µ—Ä-–ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤—â–∏–∫: BAAI/bge-reranker-v2-m3 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ CPU, —ç–∫–æ–Ω–æ–º–∏–º VRAM).
LLM-–±—ç–∫–µ–Ω–¥—ã (open-source):
hf ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ ü§ó Transformers (Qwen/Qwen2.5-3B-Instruct),
ollama ‚Äî Qwen2.5:3b —á–µ—Ä–µ–∑ Ollama.
–ñ—ë—Å—Ç–∫–∏–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω JSON —Å –ø–æ–ª—è–º–∏ answer –∏ used_chunks, –∫–æ—Ä–æ—Ç–∫–æ –∏ —Å —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
–¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ: —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π table/doc bias + retry —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.
1. –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫
–ß–∞–Ω–∫–∏–Ω–≥ (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è/–∫–ª–∞—É–∑—ã + —Ç–∞–±–ª–∏—Ü—ã)
–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —á–∞—Å—Ç–æ ¬´–∂–∏–≤—É—Ç¬ª –≤ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö ‚Äî —Å—Ç—Ä–æ–∫–∞—Ö —Ç–∞–±–ª–∏—Ü, –ø–æ–¥–ø—É–Ω–∫—Ç–∞—Ö –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞—Ö –≤–∏–¥–∞ ¬´–ø. X.Y¬ª.
–ü–æ—ç—Ç–æ–º—É:
–¢–µ–∫—Å—Ç —Ä–µ–∂–µ–º –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º (razdel.sentenize) —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º; –µ—Å–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω–æ–µ ‚Äî —Ä–µ–∂–µ–º –ø–æ —Å–ª–æ–≤–∞–º –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–æ–≤ (tokenize).
–¢–∞–±–ª–∏—Ü—ã –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞–Ω–∫–∏ –Ω–∞ —Å—Ç—Ä–æ–∫—É: –∫ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ –ø—Ä–∏—Ü–µ–ø–ª—è–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç–æ–ª–±—Ü–æ–≤. –≠—Ç–æ —Ä–µ–∑–∫–æ –ø–æ–≤—ã—à–∞–µ—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–µ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –≤–∏–¥–∞ ¬´—Å–∫–æ—Ä–æ—Å—Ç—å/—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞/—Ç–æ–ª—â–∏–Ω–∞/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è¬ª.
–ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ—Ç—Ä–∏–≤–∞–ª
BM25 (—á–µ—Ä–µ–∑ rank-bm25) ‚Äî —É—Å—Ç–æ–π—á–∏–≤ –∫ –æ–ø–µ—á–∞—Ç–∫–∞–º/–º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏, –¥–∞—ë—Ç —Å–∏–ª—å–Ω—ã–π ¬´–ª–µ–∫—Å–∏—á–µ—Å–∫–∏–π¬ª —Å–∏–≥–Ω–∞–ª.
Dense ‚Äî intfloat/multilingual-e5-base (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–æ–Ω–Ω–æ–µ —Å–µ–º–µ–π—Å—Ç–≤–æ e5) –¥–∞—ë—Ç —Ö–æ—Ä–æ—à–∏–π –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–π —Å–∏–≥–Ω–∞–ª –∏ –¥–µ—à–µ–≤–ª–µ, —á–µ–º large.
RRF (Reciprocal Rank Fusion) –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–ø–∏—Å–∫–∏ –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
–ü–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (CrossEncoder)
BAAI/bge-reranker-v2-m3 ‚Äî –±—ã—Å—Ç—Ä—ã–π –º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π –∫—Ä–æ—Å—Å-—ç–Ω–∫–æ–¥–µ—Ä, —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞—Ö. –î–µ—Ä–∂–∏–º –Ω–∞ CPU ‚Äî —ç–∫–æ–Ω–æ–º–∏–º VRAM –¥–ª—è LLM.
LLM: Qwen2.5-3B-Instruct
–û—Ç–∫—Ä—ã—Ç–∞—è –º–æ–¥–µ–ª—å —Å –¥–æ—Å—Ç–æ–π–Ω—ã–º —Ä—É—Å—Å–∫–∏–º –∏ –Ω–∏–∑–∫–æ–π –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å—é –≤ VRAM.
–í hf-—Ä–µ–∂–∏–º–µ –ø—Ä–∏ --device cuda –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è 4-–±–∏—Ç (—á–µ—Ä–µ–∑ bitsandbytes), —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—É—Å–∫ –≤–æ–∑–º–æ–∂–Ω—ã–º –¥–∞–∂–µ –Ω–∞ T4 –≤ Colab.
–ñ—ë—Å—Ç–∫–∏–π JSON-–ø—Ä–æ—Ç–æ–∫–æ–ª
–ü–æ–≤—ã—à–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –∏ –ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.
–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å—Ç—Ä–æ–∏–º —Ü–∏—Ç–∞—Ç—ã –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–∏–º—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ + –ø./—Ç–∞–±–ª–∏—Ü–∞), —á—Ç–æ –¥–µ–ª–∞–µ—Ç –æ—Ç–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º.
2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
DOCX ‚Üí Loader (paragraphs + tables)
     ‚Üí word-aware chunking (sentences + overlap; table rows with header)
     ‚Üí Indexes:
          BM25 (razdel tokenize)
          Embeddings (e5-base) ‚Üí FAISS(IndexFlatIP, cosine on L2-normalized)
          RRF merge  +  heuristic table/doc bias
     ‚Üí Cross-Encoder Rerank (bge-reranker-v2-m3)
     ‚Üí Top-k context ‚Üí LLM (Qwen2.5 3B) ‚Üí JSON
     ‚Üí post: parse JSON ‚Üí map chunk IDs ‚Üí citations
–î–æ–ø. —Ç–æ—á–Ω–æ—Å—Ç—å:
Table/doc bias ‚Äî –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ ¬´—Å–Ω–µ–≥/k_h/—Å–∫–æ—Ä–æ—Å—Ç—å/—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞/—Ç–æ–ª—â–∏–Ω–∞/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è¬ª —Ç–∞–±–ª–∏—Ü—ã –∏ —Ü–µ–ª–µ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –Ω–µ–±–æ–ª—å—à–æ–π –±–æ–Ω—É—Å –≤ RRF-–±–∞–ª–ª–µ.
Retry ‚Äî –µ—Å–ª–∏ LLM –≤–µ—Ä–Ω—É–ª ¬´–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏¬ª, –ø—Ä–æ–±—É–µ–º –ø–æ–≤—Ç–æ—Ä —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (–±–æ–ª—å—à–µ —Ç–æ–ø-—á–∞–Ω–∫–æ–≤ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è).
3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
git clone <your-repo>
cd <your-repo>
pip install -r requirements.txt
–í –ø—Ä–æ–µ–∫—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à—É–º—ã –ª–æ–≥–æ–≤ –ø—Ä–∏–≥–ª—É—à–µ–Ω—ã: TF_CPP_MIN_LOG_LEVEL=3, TOKENIZERS_PARALLELISM=false, TRANSFORMERS_NO_TF=1 –∏ —Ç.–ø.
4. –î–∞–Ω–Ω—ã–µ
–ü–æ–ª–æ–∂–∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ .docx —Ñ–∞–π–ª—ã –≤ –∫–∞—Ç–∞–ª–æ–≥ ./docs.
–õ–æ–∞–¥–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç:
–ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã (–ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–±–µ–ª–æ–≤/–ø–µ—Ä–µ–≤–æ–¥–æ–≤),
—Ç–∞–±–ª–∏—Ü—ã: —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–∞–Ω–∫-–∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ø–æ —á–∞–Ω–∫—É –Ω–∞ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É (—Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º [–¢–∞–±–ª–∏—Ü–∞]).
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ –¥–µ—Ç–µ–∫—Ç–æ—Ä —Ä–µ–≥—É–ª—è—Ä–∫–∞–º–∏ –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –ª–æ–∫–∞—Ç–æ—Ä—ã:
–ø. X.Y / –ø—É–Ω–∫—Ç X.Y‚Ä¶
—Ç–∞–±–ª–∏—Ü–∞ N / —Ç–∞–±–ª. N
5. –ó–∞–ø—É—Å–∫
–í–∞—Ä–∏–∞–Ω—Ç A ‚Äî HuggingFace (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ Colab)
python rag_prototype_wordaware.py \
  --data_dir ./docs \
  --backend hf \
  --model Qwen/Qwen2.5-3B-Instruct \
  --device cuda \
  --reranker_device cpu \
  --top_k_ctx 6 \
  --chunk_chars 1400 \
  --max_new_tokens 128 \
  --log_level INFO \
  --questions_file ./questions.txt
–í–∞—Ä–∏–∞–Ω—Ç B ‚Äî Ollama (–ª–æ–∫–∞–ª—å–Ω–æ)
# —É—Å—Ç–∞–Ω–æ–≤–∏ –∏ –∑–∞–ø—É—Å—Ç–∏ ollama, –∑–∞—Ç–µ–º:
ollama pull qwen2.5:3b

python rag_prototype_wordaware.py \
  --data_dir ./docs \
  --backend ollama \
  --model Qwen2.5:3b \
  --top_k_ctx 6 \
  --log_level INFO
–ê—Ä–≥—É–º–µ–Ω—Ç—ã CLI (–≤–∞–∂–Ω–æ–µ)
--data_dir ‚Äî –ø–∞–ø–∫–∞ —Å .docx (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).
--backend ‚Äî hf –∏–ª–∏ ollama.
--model ‚Äî –∏–º—è –º–æ–¥–µ–ª–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥–∞.
--device ‚Äî –¥–ª—è hf (cuda/cpu). –ü—Ä–∏ cuda –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è 4-–±–∏—Ç.
--reranker_device ‚Äî cpu/cuda –¥–ª—è –∫—Ä–æ—Å—Å-—ç–Ω–∫–æ–¥–µ—Ä–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é cpu.
--top_k_ctx ‚Äî —Å–∫–æ–ª—å–∫–æ —á–∞–Ω–∫–æ–≤ –ø–æ–ø–∞–¥—ë—Ç –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM.
--chunk_chars ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–∫–Ω–∞ –ø—Ä–∏ —á–∞–Ω–∫–∏–Ω–≥–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
--questions_file ‚Äî —Ñ–∞–π–ª —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫–µ).
--log_level ‚Äî —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤ (DEBUG/INFO/WARNING/ERROR).
–í—ã–≤–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ results_YYYYMMDD_HHMMSS.json:
[
  {
    "question": "...",
    "answer": "–∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç",
    "citations": [
      {"document": "–°–ü 20.13330.2016", "table": "—Ç–∞–±–ª–∏—Ü–∞ 1"},
      {"document": "–°–ü 91.13330.2012", "clause": "–ø. 5.3"}
    ],
    "latency_sec": 0.987
  }
]
6. –í–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (–¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
6.1. –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥
normalize_text ‚Äî —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–µ–ª–æ–≤, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å—Ç—Ä–æ–∫.
extract_locator ‚Äî —Ä–µ–≥—É–ª—è—Ä–∫–∏ –¥–ª—è –ø./–ø—É–Ω–∫—Ç –∏ —Ç–∞–±–ª–∏—Ü–∞/—Ç–∞–±–ª.; —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Chunk.locator.
6.2. –ß–∞–Ω–∫–∏–Ω–≥
–°–ª–∞–π–¥–∏–Ω–≥-–æ–∫–Ω–æ –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º (overlap_sents=1), –∂–µ—Å—Ç–∫–∏–π word-aware cut –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
–¢–∞–±–ª–∏—Ü–∞ ‚Üí [–¢–∞–±–ª–∏—Ü–∞]\n<–∑–∞–≥–æ–ª–æ–≤–æ–∫>\n<—Å—Ç—Ä–æ–∫–∞>, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∫–∞–∫ BM25, —Ç–∞–∫ –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º.
6.3. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
BM25: —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è razdel.tokenize, —Ä–µ–≥–∏—Å—Ç—Ä ‚Üí lower.
Embeddings: SentenceTransformer(intfloat/multilingual-e5-base); –∞–≤—Ç–æ-device (cuda –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ), progress-bar, –±–∞—Ç—á 64; –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤.
FAISS: IndexFlatIP –Ω–∞ float32 + contiguous; –∫–æ—Å–∏–Ω—É—Å —á–µ—Ä–µ–∑ inner product –Ω–∞ –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–∞—Ö.
RRF: —Å–∫–ª–∞–¥—ã–≤–∞–µ–º 1/(K+rank) (K=60) –∏–∑ –¥–≤—É—Ö —Ä–∞–Ω–∫–æ–≤ (BM25, FAISS).
Table/doc bias (—ç–≤—Ä–∏—Å—Ç–∏–∫–∞): –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ –∑–∞–ø—Ä–æ—Å–µ (—Å–Ω–µ–≥/k_h/—Å–∫–æ—Ä–æ—Å—Ç—å/—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞/—Ç–æ–ª—â–∏–Ω–∞/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è) –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ–±–æ–ª—å—à–æ–π –±–æ–Ω—É—Å —Å—Ç—Ä–æ–∫–∞–º —Ç–∞–±–ª–∏—Ü –∏ —Ü–µ–ª–µ–≤—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º (–Ω–∞–ø—Ä., –ü–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Ññ87, –°–ü 91).
6.4. –ü–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
BAAI/bge-reranker-v2-m3 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ CPU). –ù–∞ –≤—Ö–æ–¥ ‚Äî –ø–∞—Ä—ã (–≤–æ–ø—Ä–æ—Å, —á–∞–Ω–∫), –Ω–∞ –≤—ã—Ö–æ–¥ ‚Äî —Å–∫–æ—Ä; –±–µ—Ä—ë–º top-k.
6.5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
–§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–≥–∏–π –ø—Ä–æ–º–ø—Ç: —Å–ø–∏—Å–æ–∫ —á–∞–Ω–∫–æ–≤ —Å [ID] + ¬´–≤–µ—Ä–Ω–∏ —Ä–æ–≤–Ω–æ JSON¬ª.
–î–ª—è HF: –ø—Ä–∏–º–µ–Ω—è–µ–º —á–∞—Ç-—Ç–µ–º–ø–ª–µ–π—Ç —Ç–æ–∫–µ–Ω–∞–π–∑–µ—Ä–∞, do_sample=False, max_new_tokens –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è.
Retry: –µ—Å–ª–∏ –ø—É—Å—Ç–æ/¬´–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏¬ª ‚Äî –¥–µ–ª–∞–µ–º –≤—Ç–æ—Ä–æ–π –ø—Ä–æ–≥–æ–Ω —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (–±–æ–ª—å—à–µ top-—á–∞–Ω–∫–æ–≤).
6.6. –¶–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü–∞—Ä—Å–∏–º JSON ‚Üí used_chunks ‚Üí —Å—Ç—Ä–æ–∏–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏: {document, clause?, table?}; –ø–æ—Ä—è–¥–æ–∫ –±–µ–∑ –¥—É–±–ª–µ–π.
7. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Ä–µ—Å—É—Ä—Å—ã
–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è 4‚Äì5k —á–∞–Ω–∫–æ–≤: –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Å—è—Ç–∫–æ–≤ —Å–µ–∫—É–Ω–¥ –Ω–∞ T4 —Å e5-base –Ω–∞ GPU (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å).
–ü–∞–º—è—Ç—å:
e5-base –Ω–∞ GPU: –Ω–∏–∑–∫–æ (~0.6‚Äì1.0 GB).
–†–µ—Ä–∞–Ω–∫–µ—Ä –Ω–∞ CPU ‚Äî –ø–æ—á—Ç–∏ ¬´–±–µ—Å–ø–ª–∞—Ç–Ω–æ¬ª –¥–ª—è VRAM.
Qwen2.5-3B-Instruct –≤ 4-–±–∏—Ç ‚Äî –æ–∫ –Ω–∞ T4.
–°–æ–≤–µ—Ç—ã:
–£–º–µ–Ω—å—à–∏—Ç—å --top_k_ctx –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ VRAM.
–°–Ω–∏–∑–∏—Ç—å --chunk_chars (—á–∞—â–µ –ø–æ–º–æ–≥–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏).
–ü—Ä–∏ –±–æ–ª—å—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å FAISS-–∏–Ω–¥–µ–∫—Å (faiss.write_index) –∏ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ.
8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
Gold-–≤–æ–ø—Ä–æ—Å—ã –ª–µ–∂–∞—Ç –≤ questions.txt.
–ú–µ—Ç—Ä–∏–∫–∞: –¥–æ–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∫—Ä–∞—Ç–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ + –Ω–∞–ª–∏—á–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ü–∏—Ç–∞—Ç—ã (–¥–æ–∫—É–º–µ–Ω—Ç + –ø./—Ç–∞–±–ª.).
–î–ª—è ¬´—Ç–∞–±–ª–∏—á–Ω—ã—Ö¬ª –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–∂–∏–¥–∞–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è table-bias –∏ retry.
9. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è (–¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞)
Rule-based —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤ (—Å–Ω–µ–≥–æ–≤—ã–µ —Ä–∞–π–æ–Ω—ã, k_h, —Å–∫–æ—Ä–æ—Å—Ç–∏/—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã/—Ç–æ–ª—â–∏–Ω—ã):
–ø–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü —Ä–µ–≥—É–ª—è—Ä–∫–∞–º–∏ ‚Üí —Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ, LLM —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–∏—è.
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ –¥–∏—Å–∫ (FAISS + —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞–Ω–∫–æ–≤).
–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (—É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è e5-base).
–û–Ω–ª–∞–π–Ω-—Ö–æ—Å—Ç–∏–Ω–≥–∏ (Together.ai / vLLM) ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –±—ç–∫–µ–Ω–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –æ—Å—Ç–∞–ª—å–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω –Ω–µ–∏–∑–º–µ–Ω–µ–Ω.
–õ–æ–∫–∞–ª—å–Ω—ã–µ SLM (Mistral-7B-Instruct, Llama-3.1-8B) ‚Äî –ø–æ –≤–∫—É—Å—É –∏ —Ä–µ—Å—É—Ä—Å–∞–º.
10. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
CUDA / cuDNN / cuBLAS –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ Colab:
—ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ ¬´–ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–æ–≤¬ª, –Ω–∞ —Ä–∞–±–æ—Ç—É –Ω–µ –≤–ª–∏—è—é—Ç ‚Äî —É –Ω–∞—Å –æ–Ω–∏ –∏ —Ç–∞–∫ –∑–∞–≥–ª—É—à–µ–Ω—ã.
trust_remote_code / Jina reranker:
–º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º BAAI/bge-reranker-v2-m3, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å trust_remote_code=True.
CUDA out of memory:
—Å–Ω–∏–∑—å --top_k_ctx, –≤–∫–ª—é—á–∏ 4-–±–∏—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ --device cuda), –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏ LLM –Ω–∞ CPU (–º–µ–¥–ª–µ–Ω–Ω–µ–µ).
python-docx vs docx:
–≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è import docx. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ requirements.txt –µ—Å—Ç—å python-docx.
11. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è)
.
‚îú‚îÄ‚îÄ docs/                         # .docx –¥–æ–∫—É–º–µ–Ω—Ç—ã (–≤—Ö–æ–¥)
‚îú‚îÄ‚îÄ questions.txt                 # —Ç–µ—Å—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã
‚îú‚îÄ‚îÄ rag_prototype_wordaware.py    # –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
12. –õ–∏—Ü–µ–Ω–∑–∏–∏ –∏ –¥–∞–Ω–Ω—ã–µ
–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏: Qwen2.5-3B-Instruct, intfloat/multilingual-e5-base, BAAI/bge-reranker-v2-m3 ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–µ/—É—Å–ª–æ–≤–Ω–æ-–æ—Ç–∫—Ä—ã—Ç—ã–µ –º–æ–¥–µ–ª–∏; –ø—Ä–æ–≤–µ—Ä—å –ª–∏—Ü–µ–Ω–∑–∏–∏ –ø—Ä–∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.
–î–æ–∫—É–º–µ–Ω—Ç—ã –≤ docs/ ‚Äî —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª–µ–π; –∏—Å–ø–æ–ª—å–∑—É–π –≤ —Ä–∞–º–∫–∞—Ö –¥–æ–ø—É—Å–∫–∞.
13. –¶–∏—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ (–ø—Ä–∏–º–µ—Ä)
Q: –ö–∞–∫–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –≥–æ—Ä–Ω—ã—Ö –≤—ã—Ä–∞–±–æ—Ç–∫–∞—Ö?
A: –ù–µ –±–æ–ª–µ–µ 26 ¬∞C (—Ç–∞–±–ª–∏—Ü–∞ 5).
–ò—Å—Ç–æ—á–Ω–∏–∫–∏:
 - document: –°–ü 91.13330.2012, table: —Ç–∞–±–ª–∏—Ü–∞ 5
–°–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä–µ–º–∏—Ç—Å—è –≤—ã–≤–æ–¥–∏—Ç—å –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –∫—Ä–∏—Ç–µ—Ä–∏–π –∫–∞—á–µ—Å—Ç–≤–∞.